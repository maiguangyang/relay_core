# =============================================================================
# LiveKit 云服务器生产环境配置
# =============================================================================
# 使用方法：livekit-server --config ./livekit-cloud.yaml
# 
# 部署前请确保：
# 1. 替换 API 密钥（keys 部分）
# 2. 检查防火墙开放所需端口
# 3. 如需 TURN/TLS，配置域名和证书
# =============================================================================

# -----------------------------------------------------------------------------
# 基础配置
# -----------------------------------------------------------------------------
# HTTP/WebSocket 端口
# 生产环境建议放在负载均衡器/Nginx 代理后，由代理处理 TLS
port: 7880

# 日志级别：debug, info, warn, error
log_level: info

# -----------------------------------------------------------------------------
# API 密钥
# -----------------------------------------------------------------------------
# 用于生成客户端连接 Token
# 格式: api_key: api_secret
# 重要：请替换为您自己的密钥！
keys:
  # 示例密钥（请替换）
  myapikey: mysecretkey123

# -----------------------------------------------------------------------------
# WebRTC 配置
# -----------------------------------------------------------------------------
rtc:
  # UDP 端口范围（用于 WebRTC 媒体流）
  # 必须在防火墙/安全组开放这些 UDP 端口的入站流量
  port_range_start: 50000
  port_range_end: 60000
  
  # WebRTC over TCP 端口（当 UDP 不可用时的回退）
  # 此端口必须直接暴露，不能放在负载均衡器后
  tcp_port: 7881
  
  # 自动发现公网 IP（云服务器必须设为 true）
  # LiveKit 会通过 STUN 服务器发现服务器的公网 IP
  use_external_ip: true
  
  # 如果 STUN 发现的 IP 不正确，可以手动指定
  # 注意：use_external_ip 优先级更高，需设为 false 才能使用 node_ip
  # node_ip: <您的云服务器公网IP>

# -----------------------------------------------------------------------------
# 内置 TURN 服务器（提高 NAT 穿透成功率）
# -----------------------------------------------------------------------------
turn:
  # 启用内置 TURN 服务器
  enabled: true
  
  # TURN over UDP（使用 443 端口可穿透部分防火墙）
  # 需要在防火墙开放 UDP 443 端口
  udp_port: 443
  
  # TURN over TLS（可穿透几乎所有企业防火墙）
  # 需要 SSL 证书（Let's Encrypt 等）
  # domain: turn.yourdomain.com
  # tls_port: 5349
  # cert_file: /etc/livekit/turn.crt
  # key_file: /etc/livekit/turn.key

# -----------------------------------------------------------------------------
# Redis 配置（多节点部署需要，单节点可选）
# -----------------------------------------------------------------------------
# 如果只部署单节点，可以注释掉此部分
# redis:
#   address: localhost:6379
#   # password: your_redis_password

# -----------------------------------------------------------------------------
# Prometheus 监控（可选）
# -----------------------------------------------------------------------------
# 启用后可通过 http://<ip>:6789/metrics 获取指标
# prometheus_port: 6789
